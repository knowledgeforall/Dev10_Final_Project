// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.23/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/mixins/ArcGISCachedService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../support/serviceTileInfoProperty ../support/TilemapCache ../../geometry/SpatialReference".split(" "),function(w,l,c,d,p,z,u,
m,J,x,L,K,S){w.ArcGISCachedService=v=>{v=function(O){function Q(){var F=O.apply(this,arguments)||this;F.copyright=null;F.minScale=0;F.maxScale=0;F.spatialReference=null;F.tileInfo=null;F.tilemapCache=null;return F}l._inheritsLoose(Q,O);var M=Q.prototype;M.readMinScale=function(F,U){return null!=U.minLOD&&null!=U.maxLOD?F:0};M.readMaxScale=function(F,U){return null!=U.minLOD&&null!=U.maxLOD?F:0};M.readTilemapCache=function(F,U){return U.capabilities&&-1<U.capabilities.indexOf("Tilemap")?new K.TilemapCache({layer:this}):
null};l._createClass(Q,[{key:"supportsBlankTile",get:function(){return 10.2<=this.version}}]);return Q}(v);c.__decorate([p.property({json:{read:{source:"copyrightText"}}})],v.prototype,"copyright",void 0);c.__decorate([p.property()],v.prototype,"minScale",void 0);c.__decorate([J.reader("service","minScale")],v.prototype,"readMinScale",null);c.__decorate([p.property()],v.prototype,"maxScale",void 0);c.__decorate([J.reader("service","maxScale")],v.prototype,"readMaxScale",null);c.__decorate([p.property({type:S})],
v.prototype,"spatialReference",void 0);c.__decorate([p.property({readOnly:!0})],v.prototype,"supportsBlankTile",null);c.__decorate([p.property(L.serviceTileInfoProperty)],v.prototype,"tileInfo",void 0);c.__decorate([p.property()],v.prototype,"tilemapCache",void 0);c.__decorate([J.reader("service","tilemapCache",["capabilities"])],v.prototype,"readTilemapCache",null);c.__decorate([p.property()],v.prototype,"version",void 0);return v=c.__decorate([x.subclass("esri.layers.mixins.ArcGISCachedService")],
v)};Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/support/serviceTileInfoProperty":function(){define(["exports","./TileInfo"],function(w,l){function c(p,z,u,m){if(!p)return null;const {minScale:J,maxScale:x,minLOD:L,maxLOD:K}=z;if(null!=L&&null!=K)return m&&m.ignoreMinMaxLOD?l.fromJSON(p):l.fromJSON({...p,lods:p.lods.filter(({level:S})=>null!=S&&S>=L&&S<=K)});if(0!==J&&0!==x){const S=J?Math.round(1E4*J)/1E4:Infinity,v=x?Math.round(1E4*x)/1E4:-Infinity;return l.fromJSON({...p,lods:p.lods.filter(O=>
{O=Math.round(1E4*O.scale)/1E4;return O<=S&&O>=v})})}return l.fromJSON(p)}const d={type:l,json:{origins:{service:{read:{source:["tileInfo","minScale","maxScale","minLOD","maxLOD"],reader:c}}}}};w.readServiceTileInfo=c;w.serviceTileInfoProperty=d;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(w,l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q,M,F,U){var V;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});d=V=function(t){function A(f){f=t.call(this,f)||this;f.dpi=96;f.format=null;f.origin=null;f.minScale=0;f.maxScale=0;f.size=null;f.spatialReference=null;return f}w._inheritsLoose(A,t);A.create=function(f=
{}){const {resolutionFactor:g=1,scales:h,size:b=256,spatialReference:k=O.WebMercator,numLODs:y=24}=f;if(!M.isValid(k)){f=[];if(h)for(var q=0;q<h.length;q++){var C=h[q];f.push({level:q,scale:C,resolution:C})}else for(q=5E-4,C=y-1;0<=C;C--)f.unshift({level:C,scale:q,resolution:q}),q*=2;return new V({dpi:96,lods:f,origin:new v(0,0,k),size:[b,b],spatialReference:k})}q=M.getInfo(k);f=f.origin?new v({x:f.origin.x,y:f.origin.y,spatialReference:k}):q?new v({x:q.origin[0],y:q.origin[1],spatialReference:k}):
new v({x:0,y:0,spatialReference:k});q=1/(39.37*z.getMetersPerUnitForSR(k)*96);C=[];if(h)for(var N=0;N<h.length;N++){var P=h[N];C.push({level:N,scale:P,resolution:P*q})}else{var D=M.isGeographic(k)?512/b*5.916575275917094E8:256/b*5.91657527591555E8;N=Math.ceil(y/g);C.push({level:0,scale:D,resolution:D*q});for(P=1;P<N;P++)D/=2**g,C.push({level:P,scale:D,resolution:D*q})}return new V({dpi:96,lods:C,origin:f,size:[b,b],spatialReference:k})};var E=A.prototype;E.readOrigin=function(f,g){return v.fromJSON({spatialReference:g.spatialReference,
...f})};E.readSize=function(f,g){return[g.cols,g.rows]};E.writeSize=function(f,g){g.cols=f[0];g.rows=f[1]};E.zoomToScale=function(f){const g=this.scales;if(0>=f)return g[0];if(f>=g.length-1)return g[g.length-1];{const h=Math.floor(f);return g[h]/(g[h]/g[h+1])**(f-h)}};E.scaleToZoom=function(f){const g=this.scales,h=g.length-1;let b=0;for(;b<h;b++){const k=g[b],y=g[b+1];if(k<=f)break;if(y===f)return b+1;if(k>f&&y<f)return b+Math.log(k/f)/Math.log(k/y)}return b};E.snapScale=function(f,g=.95){f=this.scaleToZoom(f);
return f%Math.floor(f)>=g?this.zoomToScale(Math.ceil(f)):this.zoomToScale(Math.floor(f))};E.tileAt=function(f,g,h,b){var k=this.lodAt(f);if(!k)return null;let y;if("number"===typeof g)y=g,g=h;else{if(M.equals(g.spatialReference,this.spatialReference))y=g.x,g=g.y;else{b=F.project(g,this.spatialReference);if(p.isNone(b))return null;y=b.x;g=b.y}b=h}h=k.resolution*this.size[0];k=k.resolution*this.size[1];b||(b={id:null,level:0,row:0,col:0,extent:Q.create()});b.level=f;b.row=Math.floor((this.origin.y-
g)/k+.001);b.col=Math.floor((y-this.origin.x)/h+.001);this.updateTileInfo(b);return b};E.updateTileInfo=function(f,g=V.ExtrapolateOptions.NONE){var h=this.lodAt(f.level);h||g!==V.ExtrapolateOptions.POWER_OF_TWO||(g=this.lods[this.lods.length-1],g.level<f.level&&(h=g));if(h){var b=f.level-h.level;g=h.resolution*this.size[0]/2**b;h=h.resolution*this.size[1]/2**b;f.id=`${f.level}/${f.row}/${f.col}`;f.extent||(f.extent=Q.create());f.extent[0]=this.origin.x+f.col*g;f.extent[1]=this.origin.y-(f.row+1)*
h;f.extent[2]=f.extent[0]+g;f.extent[3]=f.extent[1]+h}};E.upsampleTile=function(f){const g=this._upsampleLevels[f.level];if(!g||-1===g.parentLevel)return!1;f.level=g.parentLevel;f.row=Math.floor(f.row/g.factor+.001);f.col=Math.floor(f.col/g.factor+.001);this.updateTileInfo(f);return!0};E.getTileBounds=function(f,g){var {resolution:h}=this.lodAt(g.level);const b=h*this.size[0];h*=this.size[1];f[0]=this.origin.x+g.col*b;f[1]=this.origin.y-(g.row+1)*h;f[2]=f[0]+b;f[3]=f[1]+h;return f};E.lodAt=function(f){return this._levelToLOD&&
this._levelToLOD[f]||null};E.clone=function(){return V.fromJSON(this.write({}))};E.getOrCreateCompatible=function(f,g){if(256===this.size[0]&&256===this.size[1])return 256===f?this:null;const h=[],b=this.lods.length;for(let k=0;k<b;k++){const y=this.lods[k];h.push(new U({level:y.level,scale:y.scale,resolution:y.resolution*g}))}return new V({size:[f,f],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:h})};E._initializeUpsampleLevels=
function(){const f=this.lods;this._upsampleLevels=[];let g=null;for(let h=0;h<f.length;h++){const b=f[h];this._upsampleLevels[b.level]={parentLevel:g?g.level:-1,factor:g?g.resolution/b.resolution:0};g=b}};w._createClass(A,[{key:"isWrappable",get:function(){const {spatialReference:f,origin:g}=this;if(f&&g){const h=M.getInfo(f);return f.isWrappable&&Math.abs(h.origin[0]-g.x)<=h.dx}return!1}},{key:"lods",set:function(f){let g=0,h=0;const b=[];this._levelToLOD={};f&&(g=-Infinity,h=Infinity,f.forEach(k=>
{b.push(k.scale);g=k.scale>g?k.scale:g;h=k.scale<h?k.scale:h;this._levelToLOD[k.level]=k}));this._set("scales",b);this._set("minScale",g);this._set("maxScale",h);this._set("lods",f);this._initializeUpsampleLevels()}}]);return A}(d.JSONSupport);l.__decorate([u.property({type:Number,json:{write:!0}})],d.prototype,"compressionQuality",void 0);l.__decorate([u.property({type:Number,json:{write:!0}})],d.prototype,"dpi",void 0);l.__decorate([u.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,
write:!1}}}})],d.prototype,"format",void 0);l.__decorate([u.property({readOnly:!0})],d.prototype,"isWrappable",null);l.__decorate([u.property({type:v,json:{write:!0}})],d.prototype,"origin",void 0);l.__decorate([L.reader("origin")],d.prototype,"readOrigin",null);l.__decorate([u.property({type:[U],value:null,json:{write:!0}})],d.prototype,"lods",null);l.__decorate([u.property({readOnly:!0})],d.prototype,"minScale",void 0);l.__decorate([u.property({readOnly:!0})],d.prototype,"maxScale",void 0);l.__decorate([u.property({readOnly:!0})],
d.prototype,"scales",void 0);l.__decorate([u.property({cast:t=>Array.isArray(t)?t:"number"===typeof t?[t,t]:[256,256]})],d.prototype,"size",void 0);l.__decorate([L.reader("size",["rows","cols"])],d.prototype,"readSize",null);l.__decorate([S.writer("size",{cols:{type:x.Integer},rows:{type:x.Integer}})],d.prototype,"writeSize",null);l.__decorate([u.property({type:O,json:{write:!0}})],d.prototype,"spatialReference",void 0);d=V=l.__decorate([K.subclass("esri.layers.support.TileInfo")],d);(function(t){t=
t.ExtrapolateOptions||(t.ExtrapolateOptions={});t[t.NONE=0]="NONE";t[t.POWER_OF_TWO=1]="POWER_OF_TWO"})(d||(d={}));return d})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(w,l,c,d,p,z,u,m){var J;c=J=function(x){function L(K){K=
x.call(this,K)||this;K.cols=null;K.level=0;K.levelValue=null;K.origin=null;K.resolution=0;K.rows=null;K.scale=0;return K}w._inheritsLoose(L,x);L.prototype.clone=function(){return new J({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return L}(c.JSONSupport);l.__decorate([d.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);l.__decorate([d.property({type:u.Integer,
json:{write:!0}})],c.prototype,"level",void 0);l.__decorate([d.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);l.__decorate([d.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);l.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);l.__decorate([d.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,
"rows",void 0);l.__decorate([d.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=J=l.__decorate([m.subclass("esri.layers.support.LOD")],c)})},"esri/layers/support/TilemapCache":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Accessor ../../core/byteSizeEstimations ../../core/Error ../../core/HandleOwner ../../core/Logger ../../core/LRUCache ../../core/PooledArray ../../core/promiseUtils ../../core/reactiveUtils ../../core/scheduling ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./Tilemap".split(" "),
function(w,l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q,M,F,U,V,t){var A;const E=J.getLogger("esri.layers.support.TilemapCache");w.TilemapCache=A=function(f){function g(b){b=f.call(this,b)||this;b._pendingTilemapRequests={};b._availableLevels={};b.levels=5;b.cacheByteSize=2*z.ByteSizeUnit.MEGABYTES;b.request=d;b._prefetchingEnabled=!0;return b}l._inheritsLoose(g,f);var h=g.prototype;h.initialize=function(){this._tilemapCache=new x(this.cacheByteSize);this.handles.add([this.watch(["layer.parsedUrl","layer.tileServers?",
"layer.apiKey?","layer.customParameters?"],()=>this._initializeTilemapDefinition()),S.watch(()=>{var b,k;return null==(b=this.layer)?void 0:null==(k=b.tileInfo)?void 0:k.lods},b=>this._initializeAvailableLevels(b),S.syncAndInitial)]);this._initializeTilemapDefinition()};h.castLevels=function(b){return 2>=b?(E.error("Minimum levels for Tilemap is 3, but got ",b),3):b};h.fetchTilemap=function(b,k,y,q){if(!this._availableLevels[b])return Promise.reject(new u("tilemap-cache:level-unavailable",`Level ${b} is unavailable in the service`));
const C=this._tmpTilemapDefinition;if(b=this._tilemapFromCache(b,k,y,C))return Promise.resolve(b);const N=q&&q.signal;q={...q,signal:null};return new Promise((P,D)=>{K.onAbort(N,()=>D(K.createAbortError()));const W=t.tilemapDefinitionId(C);let G=this._pendingTilemapRequests[W];if(!G){G=t.Tilemap.fromDefinition(C,q).then(H=>{this._tilemapCache.put(W,H,H.byteSize);return H});const n=()=>delete this._pendingTilemapRequests[W];this._pendingTilemapRequests[W]=G;G.then(n,n)}G.then(P,D)})};h.getAvailability=
function(b,k,y){return this._availableLevels[b]?(b=this._tilemapFromCache(b,k,y,this._tmpTilemapDefinition))?b.getAvailability(k,y):"unknown":"unavailable"};h.fetchAvailability=function(b,k,y,q){return this._availableLevels[b]?this.fetchTilemap(b,k,y,q).catch(C=>C).then(C=>{if(C instanceof t.Tilemap)return C=C.getAvailability(k,y),"unavailable"===C?Promise.reject(new u("tile-map:tile-unavailable","Tile is not available",{level:b,row:k,col:y})):C;if(K.isAbortError(C))throw C;return"unknown"}):Promise.reject(new u("tilemap-cache:level-unavailable",
`Level ${b} is unavailable in the service`))};h.fetchAvailabilityUpsample=function(b,k,y,q,C){q.level=b;q.row=k;q.col=y;const N=this.layer.tileInfo;N.updateTileInfo(q);const P=this.fetchAvailability(b,k,y,C).catch(D=>{if(K.isAbortError(D))throw D;if(N.upsampleTile(q))return this.fetchAvailabilityUpsample(q.level,q.row,q.col,q);throw D;});this._fetchAvailabilityUpsamplePrefetch(q.id,b,k,y,C,P);return P};h._fetchAvailabilityUpsamplePrefetch=function(){var b=l._asyncToGenerator(function*(k,y,q,C,N,P){if(this._prefetchingEnabled){var D=
`prefetch-${k}`;if(!this.handles.has(D)){var W=new AbortController;P.then(()=>W.abort(),()=>W.abort());var G=!1;this.handles.add({remove(){G||(G=!0,W.abort())}},D);yield v.waitTicks(10,W.signal).catch(()=>{});G||(G=!0,this.handles.remove(D));if(!K.isAborted(W))for(k={id:k,level:y,row:q,col:C},N={...N,signal:W.signal},y=this.layer.tileInfo,q=0;A._prefetches.length<A._maxPrefetch&&y.upsampleTile(k);++q){const n=this.fetchAvailability(k.level,k.row,k.col,N);A._prefetches.push(n);C=()=>{A._prefetches.removeUnordered(n)};
n.then(C,C)}}}});return function(k,y,q,C,N,P){return b.apply(this,arguments)}}();h._initializeTilemapDefinition=function(){var b;if(this.layer.parsedUrl){var {parsedUrl:k,apiKey:y,customParameters:q}=this.layer;this._tilemapCache.clear();this._tmpTilemapDefinition={service:{url:k.path,query:O.objectToQuery({...k.query,...q,token:null!=y?y:null==(b=k.query)?void 0:b.token}),tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,
col:0}}};h._tilemapFromCache=function(b,k,y,q){q.level=b;q.row=k-k%this.size;q.col=y-y%this.size;b=t.tilemapDefinitionId(q);return this._tilemapCache.get(b)};h._initializeAvailableLevels=function(b){this._availableLevels={};b&&b.forEach(k=>this._availableLevels[k.level]=!0)};l._createClass(g,[{key:"size",get:function(){return 1<<this.levels}},{key:"test",get:function(){const b=this;return{get prefetchingEnabled(){return b._prefetchingEnabled},set prefetchingEnabled(k){b._prefetchingEnabled=k},hasTilemap(k,
y,q){return!!b._tilemapFromCache(k,y,q,b._tmpTilemapDefinition)}}}}]);return g}(m.HandleOwnerMixin(p));w.TilemapCache._maxPrefetch=4;w.TilemapCache._prefetches=new L({initialSize:A._maxPrefetch});c.__decorate([Q.property({constructOnly:!0,type:Number})],w.TilemapCache.prototype,"levels",void 0);c.__decorate([U.cast("levels")],w.TilemapCache.prototype,"castLevels",null);c.__decorate([Q.property({readOnly:!0,type:Number})],w.TilemapCache.prototype,"size",null);c.__decorate([Q.property({constructOnly:!0,
type:Number})],w.TilemapCache.prototype,"cacheByteSize",void 0);c.__decorate([Q.property({constructOnly:!0})],w.TilemapCache.prototype,"layer",void 0);c.__decorate([Q.property({constructOnly:!0})],w.TilemapCache.prototype,"request",void 0);w.TilemapCache=A=c.__decorate([V.subclass("esri.layers.support.TilemapCache")],w.TilemapCache);Object.defineProperty(w,"__esModule",{value:!0})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(w){function l(c){return 32+c.length}w.ByteSizeUnit=
void 0;(function(c){c[c.KILOBYTES=1024]="KILOBYTES";c[c.MEGABYTES=1048576]="MEGABYTES";c[c.GIGABYTES=1073741824]="GIGABYTES"})(w.ByteSizeUnit||(w.ByteSizeUnit={}));w.estimateAttributesObjectSize=function(c){if(!c)return 0;let d=32;for(const p in c)if(c.hasOwnProperty(p)){const z=c[p];switch(typeof z){case "string":d+=l(z);break;case "number":d+=16;break;case "boolean":d+=4}}return d};w.estimateFixedArraySize=function(c,d){return 32+c.length*d};w.estimateNumberByteSize=function(){return 16};w.estimateStringByteSize=
l;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/support/Tilemap":function(){define(["exports","../../request","../../core/arrayUtils","../../core/Error","../../core/lang"],function(w,l,c,d,p){function z(m){if("vector-tile"===m.service.type)var J=`${m.service.url}/tilemap/${m.level}/${m.row}/${m.col}/${m.width}/${m.height}`;else J=m.service.tileServers,J=`${J&&J.length?J[m.row%J.length]:m.service.url}/tilemap/${m.level}/${m.row}/${m.col}/${m.width}/${m.height}`;(m=m.service.query)&&
(J=`${J}?${m}`);return J}let u=function(){function m(){this.location={left:0,top:0,width:0,height:0};this._allAvailability="unknown";this.byteSize=40}var J=m.prototype;J.getAvailability=function(x,L){if("unknown"!==this._allAvailability)return this._allAvailability;x=(x-this.location.top)*this.location.width+(L-this.location.left);L=x>>3;const K=this._tileAvailabilityBitSet;return 0>L||L>K.length?"unknown":K[L]&1<<x%8?"available":"unavailable"};J._updateFromData=function(x){let L=!0,K=!0;const S=
new Uint8Array(Math.ceil(this.location.width*this.location.height/8));let v=0;for(let O=0;O<x.length;O++){const Q=O%8;x[O]?(K=!1,S[v]|=1<<Q):L=!1;7===Q&&++v}K?this._allAvailability="unavailable":L?this._allAvailability="available":(this._allAvailability="unknown",this._tileAvailabilityBitSet=S,this.byteSize+=S.length)};m.fromDefinition=function(x,L){const K=x.service.request||l,{row:S,col:v,width:O,height:Q}=x,M={query:{f:"json"}};L=L?{...M,...L}:M;return K(z(x),L).then(F=>F.data).catch(F=>{if(F&&
F.details&&422===F.details.httpStatus)return{location:{top:S,left:v,width:O,height:Q},valid:!0,data:c.constant(O*Q,0)};throw F;}).then(F=>{if(F.location&&(F.location.top!==S||F.location.left!==v||F.location.width!==O||F.location.height!==Q))throw new d("tilemap:location-mismatch","Tilemap response for different location than requested",{response:F,definition:{top:S,left:v,width:O,height:Q}});return m.fromJSON(F)})};m.fromJSON=function(x){m._validateJSON(x);const L=new m;L.location=Object.freeze(p.clone(x.location));
L._updateFromData(x.data);return Object.freeze(L)};m._validateJSON=function(x){if(!x||!x.location)throw new d("tilemap:missing-location","Location missing from tilemap response");if(!1===x.valid)throw new d("tilemap:invalid","Tilemap response was marked as invalid");if(!x.data)throw new d("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(x.data))throw new d("tilemap:data-mismatch","Data must be an array of numbers");if(x.data.length!==x.location.width*x.location.height)throw new d("tilemap:data-mismatch",
"Number of data items does not match width/height of tilemap");};return m}();w.Tilemap=u;w.default=u;w.tilemapDefinitionId=function(m){return`${m.level}/${m.row}/${m.col}/${m.width}/${m.height}`};Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(w,l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q){w.ArcGISMapService=M=>{M=function(F){function U(){var t=F.apply(this,arguments)||this;t.capabilities=void 0;t.copyright=null;t.fullExtent=null;t.legendEnabled=!0;t.spatialReference=null;t.version=void 0;return t}l._inheritsLoose(U,F);var V=U.prototype;V.readCapabilities=function(t,A){var E,f,g=A.capabilities&&A.capabilities.split(",").map(D=>D.toLowerCase().trim());if(!g)return{operations:{supportsQuery:!1,supportsExportMap:!1,supportsExportTiles:!1,supportsTileMap:!1},
exportMap:null,exportTiles:null};var h=this.type;t=g.includes("query");const b=g.includes("map"),k=!!A.exportTilesAllowed;g=g.includes("tilemap");const y="tile"!==h&&!!A.supportsDynamicLayers,q="tile"!==h&&(!A.tileInfo||y),C="tile"!==h&&(!A.tileInfo||y);h="tile"!==h;const N=A.cimVersion&&u.Version.parse(A.cimVersion),P=null!=(E=null==N?void 0:N.since(1,4))?E:!1;E=null!=(f=null==N?void 0:N.since(2,0))?f:!1;return{operations:{supportsQuery:t,supportsExportMap:b,supportsExportTiles:k,supportsTileMap:g},
exportMap:b?{supportsArcadeExpressionForLabeling:P,supportsSublayersChanges:h,supportsDynamicLayers:y,supportsSublayerVisibility:q,supportsSublayerDefinitionExpression:C,supportsCIMSymbols:E}:null,exportTiles:k?{maxExportTilesCount:+A.maxExportTilesCount}:null}};V.readVersion=function(t,A){(t=A.currentVersion)||(t=A.hasOwnProperty("capabilities")||A.hasOwnProperty("tables")?10:A.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return t};V.fetchSublayerInfo=function(){var t=l._asyncToGenerator(function*(A,
E){yield this.fetchAllLayersAndTables(E);return this._allLayersAndTablesMap.get(A)});return function(A,E){return t.apply(this,arguments)}}();V.fetchAllLayersAndTables=function(){var t=l._asyncToGenerator(function*(A){yield this.load(A);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=d(z.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(f=>{this._allLayersAndTablesMap=new Map;for(const g of f.data.layers)this._allLayersAndTablesMap.set(g.id,
g);return{result:f.data}},f=>({error:f})));const E=yield this._allLayersAndTablesPromise;p.throwIfAborted(A);if("result"in E)return E.result;throw E.error;});return function(A){return t.apply(this,arguments)}}();return U}(M);c.__decorate([m.property({readOnly:!0})],M.prototype,"capabilities",void 0);c.__decorate([K.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],M.prototype,"readCapabilities",null);c.__decorate([m.property({json:{read:{source:"copyrightText"}}})],
M.prototype,"copyright",void 0);c.__decorate([m.property({type:v})],M.prototype,"fullExtent",void 0);c.__decorate([m.property(Q.id)],M.prototype,"id",void 0);c.__decorate([m.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],M.prototype,"legendEnabled",void 0);c.__decorate([m.property(Q.popupEnabled)],M.prototype,"popupEnabled",void 0);c.__decorate([m.property({type:O})],M.prototype,"spatialReference",void 0);c.__decorate([m.property({readOnly:!0})],
M.prototype,"version",void 0);c.__decorate([K.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],M.prototype,"readVersion",null);return M=c.__decorate([S.subclass("esri.layers.mixins.ArcGISMapService")],M)};Object.defineProperty(w,"__esModule",{value:!0})})},"esri/core/Version":function(){define(["exports","./Error"],function(w,l){let c=function(){function d(z,u,m=""){this.major=z;this.minor=u;this._context=m}var p=d.prototype;p.lessThan=function(z,u){return this.major<
z||z===this.major&&this.minor<u};p.since=function(z,u){return!this.lessThan(z,u)};p.validate=function(z){if(this.major!==z.major)throw new l((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:z});};p.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(z,u=""){const [m,J]=z.split(".");var x=/^\s*\d+\s*$/;if(!m||!m.match||!m.match(x))throw new l((u&&
u+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:z});if(!J||!J.match||!J.match(x))throw new l((u&&u+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:z});z=parseInt(m,10);x=parseInt(J,10);return new d(z,x,u)};return d}();w.Version=c;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/utils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(w,l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q){function M(t,A){const E=[],f={};if(!t)return E;t.forEach(g=>{const h=new O;h.read(g,A);f[h.id]=h;null!=g.parentLayerId&&-1!==g.parentLayerId?(g=f[g.parentLayerId],g.sublayers||(g.sublayers=[]),g.sublayers.unshift(h)):E.unshift(h)});return E}function F(t,A){t&&t.forEach(E=>{A(E);E.sublayers&&E.sublayers.length&&F(E.sublayers,A)})}const U=u.getLogger("esri.layers.TileLayer"),V=d.ofType(O);w.SublayersOwner=t=>{t=function(A){function E(...g){var h=A.call(this,
...g)||this;h.allSublayers=new p({getCollections:()=>[h.sublayers],getChildrenFunction(b){return b.sublayers}});h.sublayersSourceJSON={[v.OriginId.SERVICE]:{},[v.OriginId.PORTAL_ITEM]:{},[v.OriginId.WEB_SCENE]:{},[v.OriginId.WEB_MAP]:{}};h.handles.add(h.watch("sublayers",(b,k)=>h._handleSublayersChange(b,k),!0));return h}l._inheritsLoose(E,A);var f=E.prototype;f.readSublayers=function(g,h){if(h&&g){var {sublayersSourceJSON:b}=this,k=v.nameToId(h.origin);if(!(k<v.OriginId.SERVICE||(b[k]={context:h,
visibleLayers:g.visibleLayers||b[k].visibleLayers,layers:g.layers||b[k].layers},k>v.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:y,origin:q}=this.createSublayersForOrigin("web-document");g=L.getProperties(this);g.setDefaultOrigin(q);this._set("sublayers",new V(y));g.setDefaultOrigin("user")}}};f.findSublayerById=function(g){return this.allSublayers.find(h=>h.id===g)};f.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
f.createSublayersForOrigin=function(g){const h="web-document"===g?v.nameToId("web-map"):v.nameToId(g);let b=v.OriginId.SERVICE;g=this.sublayersSourceJSON[v.OriginId.SERVICE].layers;let k=this.sublayersSourceJSON[v.OriginId.SERVICE].context,y=null;var q=[v.OriginId.PORTAL_ITEM,v.OriginId.WEB_SCENE,v.OriginId.WEB_MAP].filter(G=>G<=h);for(var C of q)q=this.sublayersSourceJSON[C],Q.isSublayerOverhaul(q.layers)&&(b=C,g=q.layers,k=q.context,q.visibleLayers&&(y={visibleLayers:q.visibleLayers,context:q.context}));
C=[v.OriginId.PORTAL_ITEM,v.OriginId.WEB_SCENE,v.OriginId.WEB_MAP].filter(G=>G>b&&G<=h);let N=null;for(var P of C){const {layers:G,visibleLayers:n,context:H}=this.sublayersSourceJSON[P];G&&(N={layers:G,context:H});n&&(y={visibleLayers:n,context:H})}P=M(g,k);const D=new Map,W=new Set;if(N)for(const G of N.layers)D.set(G.id,G);if(y)for(const G of y.visibleLayers)W.add(G);F(P,G=>{N&&G.read(D.get(G.id),N.context);y&&G.read({defaultVisibility:W.has(G.id)},y.context)});return{origin:v.idToName(b),sublayers:new V({items:P})}};
f.read=function(g,h){A.prototype.read.call(this,g,h);this.readSublayers(g,h)};f._handleSublayersChange=function(g,h){h&&(h.forEach(b=>{b.parent=null;b.layer=null}),this.handles.remove("sublayers-owner"));g&&(g.forEach(b=>{b.parent=this;b.layer=this}),this.handles.add([g.on("after-add",({item:b})=>{b.parent=this;b.layer=this}),g.on("after-remove",({item:b})=>{b.parent=null;b.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(g.on("before-changes",b=>{U.error(new z("tilelayer:sublayers-non-modifiable",
"ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));b.preventDefault()}),"sublayers-owner"))};return E}(t);c.__decorate([m.property({readOnly:!0})],t.prototype,"allSublayers",void 0);c.__decorate([m.property({readOnly:!0,type:d.ofType(O)})],t.prototype,"serviceSublayers",void 0);c.__decorate([m.property({value:null,type:V,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],t.prototype,"sublayers",void 0);c.__decorate([m.property({readOnly:!0})],t.prototype,"sublayersSourceJSON",
void 0);return t=c.__decorate([S.subclass("esri.layers.mixins.SublayersOwner")],t)};w.forEachSublayer=F;Object.defineProperty(w,"__esModule",{value:!0})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ./FeatureType ./Field ./FieldsIndex ./LabelClass ./LayerFloorInfo ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/Query ../../support/popupUtils ../../views/support/floorFilterUtils ../../geometry/Extent".split(" "),
function(w,l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q,M,F,U,V,t,A,E,f,g,h,b,k,y,q,C,N,P,D,W,G,n,H,X,Z,ba,ia,da,qa,ra){function la(T){return T&&"esriSMS"===T.type}function ma(T,aa,B){var a;T=this.originIdOf(aa)>=D.nameToId(B.origin);return{ignoreOrigin:!0,allowNull:T,enabled:B?"map-image"===(null==(a=B.layer)?void 0:a.type)&&(B.writeSublayerStructure||T):!1}}function pa(T,aa,B){var a;return{enabled:B?"tile"===(null==(a=B.layer)?void 0:a.type)&&this._isOverridden(aa):!1}}function ca(T,aa,B){return{ignoreOrigin:!0,
enabled:B&&B.writeSublayerStructure||!1}}function ja(T,aa,B){return{ignoreOrigin:!0,enabled:B?B.writeSublayerStructure||this.originIdOf(aa)>=D.nameToId(B.origin):!1}}var ka;const na=E.getLogger("esri.layers.support.Sublayer");let sa=0;const fa=new Set;fa.add("layer");fa.add("parent");fa.add("loaded");fa.add("loadStatus");fa.add("loadError");fa.add("loadWarnings");d=ka=function(T){function aa(a){a=T.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.globalIdField=null;a.legendEnabled=
!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;return a}l._inheritsLoose(aa,T);var B=aa.prototype;B.load=function(){var a=l._asyncToGenerator(function*(e){var r=this;this.addResolvingPromise(l._asyncToGenerator(function*(){var I;if(!r.layer&&!r.url)throw new F("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:r});let R=null;if(!r.layer||r.originIdOf("url")>D.OriginId.SERVICE||"data-layer"===
(null==(I=r.source)?void 0:I.type))R=(yield O(r.url,{responseType:"json",query:{f:"json"},...e})).data;else{var Y;I=r.id;"map-layer"===(null==(Y=r.source)?void 0:Y.type)&&(I=r.source.mapLayerId);R=yield r.layer.fetchSublayerInfo(I,e)}R&&(r.sourceJSON=R,r.read({layerDefinition:R},{origin:"service"}))})());return this});return function(e){return a.apply(this,arguments)}}();B.readCapabilities=function(a,e){e=e.layerDefinition||e;a=(a=e.capabilities||a)?a.toLowerCase().split(",").map(r=>r.trim()):[];
return{exportMap:{supportsModification:!!e.canModifyLayer},operations:{supportsQuery:-1!==a.indexOf("query")}}};B.readGlobalIdFieldFromService=function(a,e){e=e.layerDefinition||e;if(e.globalIdField)return e.globalIdField;if(e.fields)for(const r of e.fields)if("esriFieldTypeGlobalID"===r.type)return r.name};B.writeLabelingInfo=function(a,e,r,I){a&&a.length&&(e.layerDefinition={drawingInfo:{labelingInfo:a.map(R=>R.write({},I))}})};B.readMinScale=function(a,e){return e.minScale||e.layerDefinition&&
e.layerDefinition.minScale||0};B.readMaxScale=function(a,e){return e.maxScale||e.layerDefinition&&e.layerDefinition.maxScale||0};B.readObjectIdFieldFromService=function(a,e){e=e.layerDefinition||e;if(e.objectIdField)return e.objectIdField;if(e.fields)for(const r of e.fields)if("esriFieldTypeOID"===r.type)return r.name};B.readOpacity=function(a,e){a=e.layerDefinition;return 1-.01*(null!=a.transparency?a.transparency:a.drawingInfo.transparency)};B.writeOpacity=function(a,e,r,I){e.layerDefinition={drawingInfo:{transparency:100-
100*a}}};B.writeParent=function(a,e){e.parentLayerId=this.parent&&this.parent!==this.layer?P.ensureInteger(this.parent.id):-1};B.castSublayers=function(a){return P.ensureType(M.ofType(ka),a)};B.writeSublayers=function(a,e,r){this.get("sublayers.length")&&(e[r]=this.sublayers.map(I=>I.id).toArray().reverse())};B.readTypeIdField=function(a,e){e=e.layerDefinition||e;let r=e.typeIdField;r&&e.fields&&(r=r.toLowerCase(),a=e.fields.find(I=>I.name.toLowerCase()===r))&&(r=a.name);return null};B.writeVisible=
function(a,e,r,I){e[r]=this.getAtOrigin("defaultVisibility","service")||a};B.clone=function(){const {store:a}=k.getProperties(this),e=new ka;k.getProperties(e).store=a.clone(fa);this.commitProperty("url");e._lastParsedUrl=this._lastParsedUrl;return e};B.createPopupTemplate=function(a){return da.createPopupTemplate(this,a)};B.createQuery=function(){return new ia({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};B.createFeatureLayer=function(){var a=l._asyncToGenerator(function*(){var e,
r;if(this.hasOwnProperty("sublayers"))return null;const I=null==(e=this.layer)?void 0:e.parsedUrl;e=new (yield new Promise((R,Y)=>w(["../FeatureLayer"],ea=>R(Object.freeze({__proto__:null,default:ea})),Y))).default({url:I.path});I&&this.source&&("map-layer"===this.source.type?e.layerId=this.source.mapLayerId:e.dynamicDataSource=this.source);null!=this.layer.refreshInterval&&(e.refreshInterval=this.layer.refreshInterval);this.definitionExpression&&(e.definitionExpression=this.definitionExpression);
this.floorInfo&&(e.floorInfo=t.clone(this.floorInfo));this.originIdOf("labelingInfo")>D.OriginId.SERVICE&&(e.labelingInfo=t.clone(this.labelingInfo));this.originIdOf("labelsVisible")>D.OriginId.DEFAULTS&&(e.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>D.OriginId.DEFAULTS&&(e.legendEnabled=this.legendEnabled);this.originIdOf("visible")>D.OriginId.DEFAULTS&&(e.visible=this.visible);this.originIdOf("minScale")>D.OriginId.DEFAULTS&&(e.minScale=this.minScale);this.originIdOf("maxScale")>
D.OriginId.DEFAULTS&&(e.maxScale=this.maxScale);this.originIdOf("opacity")>D.OriginId.DEFAULTS&&(e.opacity=this.opacity);this.originIdOf("popupTemplate")>D.OriginId.DEFAULTS&&(e.popupTemplate=t.clone(this.popupTemplate));this.originIdOf("renderer")>D.OriginId.SERVICE&&(e.renderer=t.clone(this.renderer));"data-layer"===(null==(r=this.source)?void 0:r.type)&&(e.dynamicDataSource=this.source.clone());this.originIdOf("title")>D.OriginId.DEFAULTS&&(e.title=this.title);"map-image"===this.layer.type&&this.layer.originIdOf("customParameters")>
D.OriginId.DEFAULTS&&(e.customParameters=this.layer.customParameters);"tile"===this.layer.type&&this.layer.originIdOf("customParameters")>D.OriginId.DEFAULTS&&(e.customParameters=this.layer.customParameters);return e});return function(){return a.apply(this,arguments)}}();B.getField=function(a){return this.fieldsIndex.get(a)};B.getFeatureType=function(a){const {typeIdField:e,types:r}=this;if(!e||!a)return null;const I=a.attributes?a.attributes[e]:void 0;if(null==I)return null;let R=null;r.some(Y=>
{const {id:ea}=Y;if(null==ea)return!1;ea.toString()===I.toString()&&(R=Y);return!!R});return R};B.getFieldDomain=function(a,e){return(e=this.getFeatureType(e&&e.feature))&&(e=e.domains&&e.domains[a])&&"inherited"!==e.type?e:this._getLayerDomain(a)};B.queryFeatures=function(){var a=l._asyncToGenerator(function*(e=this.createQuery(),r){var I,R,Y,ea;yield this.load();if(!this.get("capabilities.operations.supportsQuery"))throw new F("Sublayer.queryFeatures","this layer doesn't support queries.");const [{executeQuery:ta},
{default:ua}]=yield Promise.all([new Promise((ha,oa)=>w(["../../rest/query/operations/query"],ha,oa)),new Promise((ha,oa)=>w(["../../rest/support/FeatureSet"],va=>ha(Object.freeze({__proto__:null,default:va})),oa))]);e=yield ta(this.url,ia.from(e),null!=(I=null==(R=this.layer)?void 0:R.spatialReference)?I:null,{...r,query:{...null==(Y=this.layer)?void 0:Y.customParameters,token:null==(ea=this.layer)?void 0:ea.apiKey}});I=ua.fromJSON(e.data);if(null!=I&&I.features)for(const ha of I.features)ha.sourceLayer=
this;return I});return function(){return a.apply(this,arguments)}}();B.toExportImageJSON=function(a){var e;const r={id:this.id,source:(null==(e=this.source)?void 0:e.toJSON())||{mapLayerId:this.id,type:"mapLayer"}};this.definitionExpression?(a=f.isSome(a)?qa.combineFloorsDefinitionExpression(a,this):this.definitionExpression,r.definitionExpression=a):f.isSome(a)&&(r.definitionExpression=a);const I=["renderer","labelingInfo","opacity","labelsVisible"].reduce((R,Y)=>{R[Y]=this.originIdOf(Y);return R},
{});Object.keys(I).some(R=>I[R]>D.OriginId.SERVICE)&&(a=r.drawingInfo={},I.renderer>D.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():null),I.labelsVisible>D.OriginId.SERVICE&&(a.showLabels=this.labelsVisible),this.labelsVisible&&I.labelingInfo>D.OriginId.SERVICE&&(a.labelingInfo=this.labelingInfo?this.labelingInfo.map(R=>R.write({},{origin:"service",layer:this.layer})):null,a.showLabels=!0),I.opacity>D.OriginId.SERVICE&&(a.transparency=100-100*this.opacity),this._assignDefaultSymbolColors(a.renderer));
return r};B._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,e=>{e.color||"esriSMSX"!==e.style&&"esriSMSCross"!==e.style||(e.color=e.outline&&e.outline.color?e.outline.color:[0,0,0,0])})};B._forEachSimpleMarkerSymbols=function(a,e){if(a){const r="uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:[];for(const I of r)la(I.symbol)&&e(I.symbol);"symbol"in a&&la(a.symbol)&&e(a.symbol);"defaultSymbol"in a&&la(a.defaultSymbol)&&e(a.defaultSymbol)}};
B._setAndNotifyLayer=function(a,e){const r=this.layer,I=this._get(a);let R,Y;switch(a){case "definitionExpression":case "floorInfo":R="supportsSublayerDefinitionExpression";case "minScale":case "maxScale":case "visible":R="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":R="supportsDynamicLayers",Y="supportsModification"}const ea=k.getProperties(this).getDefaultOrigin();if("service"!==ea){if(R&&!1===this.get(`layer.capabilities.exportMap.${R}`)){this._logLockedError(a,
`capability not available 'layer.capabilities.exportMap.${R}'`);return}if(Y&&!1===this.get(`capabilities.exportMap.${Y}`)){this._logLockedError(a,`capability not available 'capabilities.exportMap.${Y}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,e),"service"!==ea&&I!==e&&r&&r.emit&&r.emit("sublayer-update",{propertyName:a,target:this}))};B._handleSublayersChange=function(a,e){e&&(e.forEach(r=>
{r.parent=null;r.layer=null}),this.handles.removeAll());a&&(a.forEach(r=>{r.parent=this;r.layer=this.layer}),this.handles.add([a.on("after-add",({item:r})=>{r.parent=this;r.layer=this.layer}),a.on("after-remove",({item:r})=>{r.parent=null;r.layer=null}),a.on("before-changes",r=>{const I=this.get("layer.capabilities.exportMap.supportsSublayersChanges");null==I||I||(na.error(new F("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,
layer:this.layer})),r.preventDefault())})]))};B._logLockedError=function(a,e){na.error(new F("sublayer:locked",`Property '${a}' can't be changed on Sublayer from the layer '${this.layer.id}'`,{reason:e,sublayer:this,layer:this.layer}))};B._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};l._createClass(aa,[{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new n(this.fields||[])}},{key:"floorInfo",
set:function(a){this._setAndNotifyLayer("floorInfo",a)}},{key:"id",get:function(){const a=this._get("id");return null==a?sa++:a},set:function(a){this._get("id")!==a&&(!1===this.get("layer.capabilities.exportMap.supportsDynamicLayers")?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",
a)}},{key:"layer",set:function(a){this._set("layer",a);this.sublayers&&this.sublayers.forEach(e=>e.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:e}=this;return{minScale:a,maxScale:e}}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"defaultPopupTemplate",
get:function(){return this.createPopupTemplate()}},{key:"renderer",set:function(a){if(a)for(const e of a.getSymbols())if(Q.isSymbol3D(e)){na.warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",a)}},{key:"source",get:function(){return this._get("source")||new ba.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},
{key:"url",get:function(){var a,e;const r=null!=(a=null==(e=this.layer)?void 0:e.parsedUrl)?a:this._lastParsedUrl;a=this.source;if(!r)return null;this._lastParsedUrl=r;if("map-layer"===(null==a?void 0:a.type))return`${r.path}/${a.mapLayerId}`;a={layer:JSON.stringify({source:this.source})};return`${r.path}/dynamicLayer?${h.objectToQuery(a)}`},set:function(a){a?this._override("url",a):this._clearOverride("url")}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return aa}(U.HandleOwnerMixin(g.MultiOriginJSONMixin(V.IdentifiableMixin(A))));
d.test={isMapImageLayerOverridePolicy:T=>T===ca||T===ma,isTileImageLayerOverridePolicy:T=>T===pa};c.__decorate([b.property({readOnly:!0})],d.prototype,"capabilities",void 0);c.__decorate([q.reader("service","capabilities",["layerDefinition.canModifyLayer","layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);c.__decorate([b.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ma}}})],d.prototype,"definitionExpression",
null);c.__decorate([b.property({type:[G],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],d.prototype,"fields",void 0);c.__decorate([b.property({readOnly:!0})],d.prototype,"fieldsIndex",null);c.__decorate([b.property({type:X,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:ma},origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"floorInfo",null);c.__decorate([b.property({type:ra,
json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);c.__decorate([b.property({type:String})],d.prototype,"globalIdField",void 0);c.__decorate([q.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);c.__decorate([b.property({type:P.Integer,json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);c.__decorate([b.property({value:null,type:[H],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ca}}})],d.prototype,"labelingInfo",null);c.__decorate([N.writer("labelingInfo")],d.prototype,"writeLabelingInfo",null);c.__decorate([b.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ca}}})],d.prototype,"labelsVisible",null);c.__decorate([b.property({value:null})],d.prototype,"layer",null);c.__decorate([b.property({type:Boolean,
value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:ja}}})],d.prototype,"legendEnabled",void 0);c.__decorate([b.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);c.__decorate([b.property({type:Number,value:0,json:{write:{overridePolicy:ca}}})],d.prototype,"minScale",null);c.__decorate([q.reader("minScale",["minScale","layerDefinition.minScale"])],
d.prototype,"readMinScale",null);c.__decorate([b.property({type:Number,value:0,json:{write:{overridePolicy:ca}}})],d.prototype,"maxScale",null);c.__decorate([q.reader("maxScale",["maxScale","layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);c.__decorate([b.property({readOnly:!0})],d.prototype,"effectiveScaleRange",null);c.__decorate([b.property({type:String})],d.prototype,"objectIdField",void 0);c.__decorate([q.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
d.prototype,"readObjectIdFieldFromService",null);c.__decorate([b.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ca}}})],d.prototype,"opacity",null);c.__decorate([q.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],d.prototype,"readOpacity",null);c.__decorate([N.writer("opacity")],d.prototype,"writeOpacity",null);c.__decorate([b.property({json:{type:P.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,
overridePolicy:ca}}})],d.prototype,"parent",void 0);c.__decorate([N.writer("parent")],d.prototype,"writeParent",null);c.__decorate([b.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(T,aa){return!aa.disablePopup}},write:{target:"disablePopup",overridePolicy:ja,writer(T,aa,B){aa[B]=!T}}}})],d.prototype,"popupEnabled",void 0);c.__decorate([b.property({type:p,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:ja}}})],d.prototype,"popupTemplate",void 0);c.__decorate([b.property({readOnly:!0})],
d.prototype,"defaultPopupTemplate",null);c.__decorate([b.property({types:v.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca},origins:{"web-scene":{types:v.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ca}}}}})],d.prototype,"renderer",null);c.__decorate([b.property({types:{key:"type",base:null,typeMap:{"data-layer":Z.DataLayerSource,"map-layer":ba.MapLayerSource}},cast(T){if(T){if("mapLayerId"in T)return P.ensureClass(ba.MapLayerSource,
T);if("dataSource"in T)return P.ensureClass(Z.DataLayerSource,T)}return T},json:{name:"layerDefinition.source",write:{overridePolicy:ca}}})],d.prototype,"source",null);c.__decorate([b.property()],d.prototype,"sourceJSON",void 0);c.__decorate([b.property({value:null,json:{type:[P.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ca}}})],d.prototype,"sublayers",null);c.__decorate([y.cast("sublayers")],d.prototype,"castSublayers",null);c.__decorate([N.writer("sublayers")],d.prototype,
"writeSublayers",null);c.__decorate([b.property({type:String,json:{name:"name",write:{overridePolicy:ja}}})],d.prototype,"title",void 0);c.__decorate([b.property({type:String})],d.prototype,"typeIdField",void 0);c.__decorate([q.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);c.__decorate([b.property({type:[W],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],d.prototype,"types",void 0);c.__decorate([b.property({type:String,json:{read:{source:"layerUrl"},
write:{target:"layerUrl",overridePolicy:pa}}})],d.prototype,"url",null);c.__decorate([b.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ca}}})],d.prototype,"visible",null);c.__decorate([N.writer("visible")],d.prototype,"writeVisible",null);return d=ka=c.__decorate([C.subclass("esri.layers.support.Sublayer")],d)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/accessorSupport/PropertyOrigin"],function(w,
l){function c(d,p){if(!d||!d.length)return!0;p=p.slice().reverse().flatten(({sublayers:m})=>m&&m.toArray().reverse()).map(m=>m.id).toArray();if(d.length>p.length)return!1;let z=0;const u=p.length;for(const {id:m}of d){for(;z<u&&p[z]!==m;)z++;if(z>=u)return!1}return!0}w.isExportDynamic=function(d,p,z){return d.some(u=>{const m=u.source;return!(!m||"map-layer"===m.type&&m.mapLayerId===u.id&&(!m.gdbVersion||m.gdbVersion===z.gdbVersion))||u.originIdOf("renderer")>l.OriginId.SERVICE||u.originIdOf("labelingInfo")>
l.OriginId.SERVICE||u.originIdOf("opacity")>l.OriginId.SERVICE||u.originIdOf("labelsVisible")>l.OriginId.SERVICE})?!0:!c(d,p)};w.isSublayerOverhaul=function(d){return!!d&&d.some(p=>null!=p.minScale||p.layerDefinition&&null!=p.layerDefinition.minScale)};w.shouldWriteSublayerStructure=function(d,p,z){return p.flatten(({sublayers:u})=>u).length!==d.length||d.some(u=>u.originIdOf("minScale")>z||u.originIdOf("maxScale")>z||u.originIdOf("renderer")>z||u.originIdOf("labelingInfo")>z||u.originIdOf("opacity")>
z||u.originIdOf("labelsVisible")>z||u.originIdOf("source")>z)?!0:!c(d,p)};Object.defineProperty(w,"__esModule",{value:!0})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../core/Error ../core/HandleOwner ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../geometry/SpatialReference ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISCachedService ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./support/arcgisLayerUrl ./support/commonProperties ./support/Sublayer".split(" "),function(w,
l,c,d,p,z,u,m,J,x,L,K,S,v,O,Q,M,F,U,V,t,A,E,f,g,h,b,k,y,q,C,N){const P="Canvas/World_Dark_Gray_Base Canvas/World_Dark_Gray_Reference Canvas/World_Light_Gray_Base Canvas/World_Light_Gray_Reference Elevation/World_Hillshade Elevation/World_Hillshade_Dark Ocean/World_Ocean_Base Ocean/World_Ocean_Reference Ocean_Basemap Reference/World_Boundaries_and_Places Reference/World_Boundaries_and_Places_Alternate Reference/World_Transportation World_Imagery World_Street_Map World_Topo_Map".split(" ");p=function(D){function W(...n){n=
D.call(this,...n)||this;n.listMode="show";n.isReference=null;n.operationalLayerType="ArcGISTiledMapServiceLayer";n.resampling=!0;n.sourceJSON=null;n.spatialReference=null;n.path=null;n.sublayers=null;n.type="tile";n.url=null;return n}w._inheritsLoose(W,D);var G=W.prototype;G.normalizeCtorArgs=function(n,H){return"string"===typeof n?{url:n,...H}:n};G.load=function(n){const H=z.isSome(n)?n.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},n).catch(m.throwIfAbortError).then(()=>
this._fetchService(H)));return Promise.resolve(this)};G.readSpatialReference=function(n,H){return(n=n||H.tileInfo&&H.tileInfo.spatialReference)&&M.fromJSON(n)};G.writeSublayers=function(n,H,X,Z){if(this.loaded&&n){n=n.slice().reverse().flatten(({sublayers:da})=>da&&da.toArray().reverse()).toArray();var ba=[],ia={writeSublayerStructure:!1,...Z};n.forEach(da=>{da=da.write({},ia);ba.push(da)});ba.some(da=>1<Object.keys(da).length)&&(H.layers=ba)}};G.castTileServers=function(n){return Array.isArray(n)?
n.map(H=>J.urlToObject(H).path):null};G.fetchTile=function(n,H,X,Z={}){({signal:Z}=Z);n=this.getTileUrl(n,H,X);return c(n,{responseType:"image",signal:Z,query:{...this.refreshParameters}}).then(ba=>ba.data)};G.getTileUrl=function(n,H,X){const Z=J.objectToQuery({...this.parsedUrl.query,blankTile:!this.tilemapCache&&this.supportsBlankTile?!1:null,...this.customParameters,token:this.apiKey}),ba=this.tileServers;return`${ba&&ba.length?ba[H%ba.length]:this.parsedUrl.path}/tile/${n}/${H}/${X}${Z?"?"+Z:
""}`};G._fetchService=function(n){return(new Promise((H,X)=>{if(this.sourceJSON){if(null!=this.sourceJSON.bandCount&&null!=this.sourceJSON.pixelSizeX)throw new d("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");H({data:this.sourceJSON})}else{if(!this.parsedUrl)throw new d("tile-layer:undefined-url","layer's url is not defined");var Z=q.parse(this.parsedUrl.path);if(z.isSome(Z)&&"ImageServer"===Z.serverType)throw new d("tile-layer:unsupported-url","use ImageryTileLayer to open a tiled image service");
c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,token:this.apiKey},responseType:"json",signal:n}).then(H,X)}})).then(H=>{H.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=H.data;this.read(H.data,{origin:"service",url:this.parsedUrl});if(10.1===this.version&&!q.isHostedAgolService(this.url))return this._fetchServerVersion(this.url,n).then(X=>{this.read({currentVersion:X})}).catch(()=>{})})};G._fetchServerVersion=function(n,H){if(!q.isArcGISUrl(n))return Promise.reject();
n=n.replace(/(.*\/rest)\/.*/i,"$1")+"/info";return c(n,{query:{f:"json",...this.customParameters,token:this.apiKey},responseType:"json",signal:H}).then(X=>{if(X.data&&X.data.currentVersion)return X.data.currentVersion;throw new d("tile-layer:version-not-available");})};G._getMapName=function(n){return(n=n.match(/^(?:https?:)?\/\/(server\.arcgisonline\.com|services\.arcgisonline\.com|ibasemaps-api\.arcgis\.com)\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/mapserver/i))&&n[2]};G._getDefaultAttribution=
function(n){if(n){n=n.toLowerCase();for(let X=0,Z=P.length;X<Z;X++){var H=P[X];if(-1<H.toLowerCase().indexOf(n))return J.makeAbsolute("//static.arcgis.com/attribution/"+H)}}};G._getDefaultTileServers=function(n){const H=-1!==n.search(/^(?:https?:)?\/\/server\.arcgisonline\.com/i),X=-1!==n.search(/^(?:https?:)?\/\/services\.arcgisonline\.com/i);return H||X?[n,n.replace(H?/server\.arcgisonline/i:/services\.arcgisonline/i,H?"services.arcgisonline":"server.arcgisonline")]:[]};w._createClass(W,[{key:"attributionDataUrl",
get:function(){var n;const H=null==(n=this.parsedUrl)?void 0:n.path.toLowerCase();return H&&this._getDefaultAttribution(this._getMapName(H))}},{key:"tileServers",get:function(){return this._getDefaultTileServers(this.parsedUrl.path)}},{key:"hasOverriddenFetchTile",get:function(){return!this.fetchTile.__isDefault__}}]);return W}(E.BlendLayer(y.SublayersOwner(k.ScaleRangeLayer(g.OperationalLayer(h.PortalLayer(V.ArcGISCachedService(t.ArcGISMapService(A.ArcGISService(u.MultiOriginJSONMixin(p.HandleOwnerMixin(b.RefreshableLayer(U.APIKeyMixin(f.CustomParametersMixin(F))))))))))))));
l.__decorate([x.property({readOnly:!0})],p.prototype,"attributionDataUrl",null);l.__decorate([x.property({type:["show","hide","hide-children"]})],p.prototype,"listMode",void 0);l.__decorate([x.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],p.prototype,"isReference",void 0);l.__decorate([x.property({readOnly:!0,type:["ArcGISTiledMapServiceLayer"]})],p.prototype,"operationalLayerType",void 0);l.__decorate([x.property({type:Boolean})],p.prototype,"resampling",
void 0);l.__decorate([x.property()],p.prototype,"sourceJSON",void 0);l.__decorate([x.property({type:M})],p.prototype,"spatialReference",void 0);l.__decorate([v.reader("spatialReference",["spatialReference","tileInfo"])],p.prototype,"readSpatialReference",null);l.__decorate([x.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],p.prototype,"path",void 0);l.__decorate([x.property({readOnly:!0})],p.prototype,"sublayers",void 0);l.__decorate([Q.writer("sublayers",{layers:{type:[N]}})],
p.prototype,"writeSublayers",null);l.__decorate([x.property({json:{read:!1,write:!1}})],p.prototype,"popupEnabled",void 0);l.__decorate([x.property()],p.prototype,"tileServers",null);l.__decorate([S.cast("tileServers")],p.prototype,"castTileServers",null);l.__decorate([x.property({readOnly:!0,json:{read:!1}})],p.prototype,"type",void 0);l.__decorate([x.property(C.url)],p.prototype,"url",void 0);p=l.__decorate([O.subclass("esri.layers.TileLayer")],p);p.prototype.fetchTile.__isDefault__=!0;return p});