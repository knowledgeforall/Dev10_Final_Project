(window.webpackJsonp_ember_auto_import_=window.webpackJsonp_ember_auto_import_||[]).push([[1],{1050:function(e,t,r){"use strict"
r.d(t,"a",(function(){return d}))
var n=r(62),s=r(325)
var o=function(){return(o=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var s in t=arguments[r])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])
return e}).apply(this,arguments)}
function i(e,t){var r=t
return r.rawResponse=!1,Object(n.e)(e,r).then((function(e){var t={token:e.access_token,username:e.username,expires:new Date(Date.now()+(1e3*e.expires_in-1e3)),ssl:!0===e.ssl}
return e.refresh_token&&(t.refreshToken=e.refresh_token),t}))}function a(e,t){var r=t
return"undefined"!=typeof window&&window.location&&window.location.host?r.params.referer=window.location.host:r.params.referer=n.b,Object(n.e)(e,r)}var p=/^https?:\/\/(\S+)\.arcgis\.com.+/
function u(e){return p.test(e)}function h(e){if(!p.test(e))return null
var t=e.match(p)[1].split(".").pop()
return t.includes("dev")?"dev":t.includes("qa")?"qa":"production"}function c(e,t){var r=Object(s.a)(function(e){if(!p.test(e))return e
switch(h(e)){case"dev":return"https://devext.arcgis.com/sharing/rest"
case"qa":return"https://qaext.arcgis.com/sharing/rest"
default:return"https://www.arcgis.com/sharing/rest"}}(t)).replace(/https?:\/\//,""),n=Object(s.a)(e).replace(/https?:\/\//,"")
return new RegExp(n,"i").test(r)}var d=function(){function e(e){if(this.clientId=e.clientId,this._refreshToken=e.refreshToken,this._refreshTokenExpires=e.refreshTokenExpires,this.username=e.username,this.password=e.password,this._token=e.token,this._tokenExpires=e.tokenExpires,this.portal=e.portal?Object(s.a)(e.portal):"https://www.arcgis.com/sharing/rest",this.ssl=e.ssl,this.provider=e.provider||"arcgis",this.tokenDuration=e.tokenDuration||20160,this.redirectUri=e.redirectUri,this.refreshTokenTTL=e.refreshTokenTTL||20160,this.server=e.server,this.federatedServers={},this.trustedDomains=[],e.server){var t=this.getServerRootUrl(e.server)
this.federatedServers[t]={token:e.token,expires:e.tokenExpires}}this._pendingTokenRequests={}}return Object.defineProperty(e.prototype,"token",{get:function(){return this._token},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tokenExpires",{get:function(){return this._tokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshToken",{get:function(){return this._refreshToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"refreshTokenExpires",{get:function(){return this._refreshTokenExpires},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"trustedServers",{get:function(){return console.log("DEPRECATED: use federatedServers instead"),this.federatedServers},enumerable:!1,configurable:!0}),e.beginOAuth2=function(t,r){void 0===r&&(r=window),t.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead")
var s,i=o({portal:"https://www.arcgis.com/sharing/rest",provider:"arcgis",expiration:20160,popup:!0,popupWindowFeatures:"height=400,width=600,menubar=no,location=yes,resizable=yes,scrollbars=yes,status=yes",state:t.clientId,locale:""},t),a=i.portal,p=i.provider,u=i.clientId,h=i.expiration,c=i.redirectUri,d=i.popup,l=i.popupWindowFeatures,f=i.state,k=i.locale,g=i.params
if(s="arcgis"===p?a+"/oauth2/authorize?client_id="+u+"&response_type=token&expiration="+(t.duration||h)+"&redirect_uri="+encodeURIComponent(c)+"&state="+f+"&locale="+k:a+"/oauth2/social/authorize?client_id="+u+"&socialLoginProviderName="+p+"&autoAccountCreateForSocial=true&response_type=token&expiration="+(t.duration||h)+"&redirect_uri="+encodeURIComponent(c)+"&state="+f+"&locale="+k,g&&(s=s+"&"+Object(n.d)(g)),d){var m,w=((m={promise:null,resolve:null,reject:null}).promise=new Promise((function(e,t){m.resolve=e,m.reject=t})),m)
return r["__ESRI_REST_AUTH_HANDLER_"+u]=function(t,r){if(t){var s=JSON.parse(t)
w.reject(new n.a(s.errorMessage,s.error))}else if(r){var o=JSON.parse(r)
w.resolve(new e({clientId:u,portal:a,ssl:o.ssl,token:o.token,tokenExpires:new Date(o.expires),username:o.username}))}},r.open(s,"oauth-window",l),w.promise}r.location.href=s},e.completeOAuth2=function(t,r){void 0===r&&(r=window)
var s=o({portal:"https://www.arcgis.com/sharing/rest",popup:!0},t),i=s.portal,a=s.clientId,p=s.popup
function u(t,s){try{var o=void 0,u="__ESRI_REST_AUTH_HANDLER_"+a
if(p&&(r.opener?r.opener.parent&&r.opener.parent[u]?o=r.opener.parent[u]:r.opener&&r.opener[u]&&(o=r.opener[u]):r!==r.parent&&r.parent&&r.parent[u]&&(o=r.parent[u]),o))return o(t?JSON.stringify(t):void 0,JSON.stringify(s)),void r.close()}catch(e){throw new n.a('Unable to complete authentication. It\'s possible you specified popup based oAuth2 but no handler from "beginOAuth2()" present. This generally happens because the "popup" option differs between "beginOAuth2()" and "completeOAuth2()".')}if(t)throw new n.a(t.errorMessage,t.error)
return new e({clientId:a,portal:i,ssl:s.ssl,token:s.token,tokenExpires:s.expires,username:s.username})}var h=function(e){return e.replace(/^#/,"").split("&").reduce((function(e,t){var r=function(e){var t=e.split("="),r=t[0],n=t[1]
return{key:decodeURIComponent(r),value:decodeURIComponent(n)}}(t),n=r.key,s=r.value
return e[n]=s,e}),{})}(r.location.hash)
if(!h.access_token){var c=void 0,d="Unknown error"
return h.error&&(c=h.error,d=h.error_description),u({error:c,errorMessage:d})}var l=h.access_token,f=new Date(Date.now()+1e3*parseInt(h.expires_in,10)-6e4),k=h.username
return u(void 0,{token:l,expires:f,ssl:"true"===h.ssl,username:k})},e.fromParent=function(t,r){var n
return!r&&window&&(r=window),new Promise((function(s,o){n=function(t){if(t.source===r.parent&&t.data)try{return s(e.parentMessageHandler(t))}catch(e){return o(e)}},r.addEventListener("message",n,!1),r.parent.postMessage({type:"arcgis:auth:requestCredential"},t)})).then((function(e){return r.removeEventListener("message",n,!1),e}))},e.authorize=function(e,t){e.duration&&console.log("DEPRECATED: 'duration' is deprecated - use 'expiration' instead")
var r=o({portal:"https://arcgis.com/sharing/rest",expiration:20160},e),n=r.portal,s=r.clientId,i=r.expiration,a=r.redirectUri
t.writeHead(301,{Location:n+"/oauth2/authorize?client_id="+s+"&expiration="+(e.duration||i)+"&response_type=code&redirect_uri="+encodeURIComponent(a)}),t.end()},e.exchangeAuthorizationCode=function(t,r){var n=o({portal:"https://www.arcgis.com/sharing/rest",refreshTokenTTL:20160},t),s=n.portal,a=n.clientId,p=n.redirectUri,u=n.refreshTokenTTL
return i(s+"/oauth2/token",{params:{grant_type:"authorization_code",client_id:a,redirect_uri:p,code:r}}).then((function(t){return new e({clientId:a,portal:s,ssl:t.ssl,redirectUri:p,refreshToken:t.refreshToken,refreshTokenTTL:u,refreshTokenExpires:new Date(Date.now()+60*(u-1)*1e3),token:t.token,tokenExpires:t.expires,username:t.username})}))},e.deserialize=function(t){var r=JSON.parse(t)
return new e({clientId:r.clientId,refreshToken:r.refreshToken,refreshTokenExpires:new Date(r.refreshTokenExpires),username:r.username,password:r.password,token:r.token,tokenExpires:new Date(r.tokenExpires),portal:r.portal,ssl:r.ssl,tokenDuration:r.tokenDuration,redirectUri:r.redirectUri,refreshTokenTTL:r.refreshTokenTTL})},e.fromCredential=function(t){var r=void 0===t.ssl||t.ssl,n=t.expires||Date.now()+72e5
return new e({portal:t.server.includes("sharing/rest")?t.server:t.server+"/sharing/rest",ssl:r,token:t.token,username:t.userId,tokenExpires:new Date(n)})},e.parentMessageHandler=function(t){if("arcgis:auth:credential"===t.data.type)return e.fromCredential(t.data.credential)
if("arcgis:auth:error"===t.data.type){var r=new Error(t.data.error.message)
throw r.name=t.data.error.name,r}throw new Error("Unknown message type.")},e.prototype.toCredential=function(){return{expires:this.tokenExpires.getTime(),server:this.portal,ssl:this.ssl,token:this.token,userId:this.username}},e.prototype.getUser=function(e){var t=this
if(this._pendingUserRequest)return this._pendingUserRequest
if(this._user)return Promise.resolve(this._user)
var r=this.portal+"/community/self",s=o(o({httpMethod:"GET",authentication:this},e),{rawResponse:!1})
return this._pendingUserRequest=Object(n.e)(r,s).then((function(e){return t._user=e,t._pendingUserRequest=null,e})),this._pendingUserRequest},e.prototype.getPortal=function(e){var t=this
if(this._pendingPortalRequest)return this._pendingPortalRequest
if(this._portalInfo)return Promise.resolve(this._portalInfo)
var r=this.portal+"/portals/self",s=o(o({httpMethod:"GET",authentication:this},e),{rawResponse:!1})
return this._pendingPortalRequest=Object(n.e)(r,s).then((function(e){return t._portalInfo=e,t._pendingPortalRequest=null,e})),this._pendingPortalRequest},e.prototype.getUsername=function(){return this.username?Promise.resolve(this.username):this._user?Promise.resolve(this._user.username):this.getUser().then((function(e){return e.username}))},e.prototype.getToken=function(e,t){return r=this.portal,n=e,s=u(r),o=u(n),i=h(r),a=h(n),s&&o&&i===a||new RegExp(this.portal,"i").test(e)?this.getFreshToken(t):this.getTokenForServer(e,t)
var r,n,s,o,i,a},e.prototype.validateAppAccess=function(e){return this.getToken(this.portal).then((function(t){return function(e,t,r){void 0===r&&(r="https://www.arcgis.com/sharing/rest")
var s=r+"/oauth2/validateAppAccess",o={method:"POST",params:{f:"json",client_id:t,token:e}}
return Object(n.e)(s,o)}(t,e)}))},e.prototype.toJSON=function(){return{clientId:this.clientId,refreshToken:this.refreshToken,refreshTokenExpires:this.refreshTokenExpires,username:this.username,password:this.password,token:this.token,tokenExpires:this.tokenExpires,portal:this.portal,ssl:this.ssl,tokenDuration:this.tokenDuration,redirectUri:this.redirectUri,refreshTokenTTL:this.refreshTokenTTL}},e.prototype.serialize=function(){return JSON.stringify(this)},e.prototype.enablePostMessageAuth=function(e,t){!t&&window&&(t=window),this._hostHandler=this.createPostMessageHandler(e),t.addEventListener("message",this._hostHandler,!1)},e.prototype.disablePostMessageAuth=function(e){!e&&window&&(e=window),e.removeEventListener("message",this._hostHandler,!1)},e.prototype.refreshSession=function(e){return this._user=null,this.username&&this.password?this.refreshWithUsernameAndPassword(e):this.clientId&&this.refreshToken?this.refreshWithRefreshToken():Promise.reject(new n.a("Unable to refresh token."))},e.prototype.getServerRootUrl=function(e){var t=Object(s.a)(e).split(/\/rest(\/admin)?\/services(?:\/|#|\?|$)/)[0].match(/(https?:\/\/)(.+)/),r=t[1],n=t[2].split("/"),o=n[0],i=n.slice(1)
return""+r+o.toLowerCase()+"/"+i.join("/")},e.prototype.getDomainCredentials=function(e){return this.trustedDomains&&this.trustedDomains.length&&this.trustedDomains.some((function(t){return e.startsWith(t)}))?"include":"same-origin"},e.prototype.createPostMessageHandler=function(e){var t=this
return function(r){var n=e.indexOf(r.origin)>-1,s="arcgis:auth:requestCredential"===r.data.type,o=t.tokenExpires.getTime()>Date.now()
if(n&&s){var i={}
if(o){var a=t.toCredential()
a.server=a.server.replace("/sharing/rest",""),i={type:"arcgis:auth:credential",credential:a}}else i={type:"arcgis:auth:error",error:{name:"tokenExpiredError",message:"Session token was expired, and not returned to the child application"}}
r.source.postMessage(i,r.origin)}}},e.prototype.getTokenForServer=function(e,t){var r=this,s=this.getServerRootUrl(e),o=this.federatedServers[s]
return o&&o.expires&&o.expires.getTime()>Date.now()?Promise.resolve(o.token):(this._pendingTokenRequests[s]||(this._pendingTokenRequests[s]=this.fetchAuthorizedDomains().then((function(){return Object(n.e)(s+"/rest/info",{credentials:r.getDomainCredentials(e)}).then((function(o){if(o.owningSystemUrl){if(c(o.owningSystemUrl,r.portal))return Object(n.e)(o.owningSystemUrl+"/sharing/rest/info",t)
throw new n.a(e+" is not federated with "+r.portal+".","NOT_FEDERATED")}if(o.authInfo&&void 0!==r.federatedServers[s])return Promise.resolve({authInfo:o.authInfo})
throw new n.a(e+" is not federated with any portal and is not explicitly trusted.","NOT_FEDERATED")})).then((function(e){return e.authInfo.tokenServicesUrl})).then((function(t){return r.token&&r.tokenExpires.getTime()>Date.now()?a(t,{params:{token:r.token,serverUrl:e,expiration:r.tokenDuration,client:"referer"}}):a(t,{params:{username:r.username,password:r.password,expiration:r.tokenDuration,client:"referer"}}).then((function(e){return r._token=e.token,r._tokenExpires=new Date(e.expires),e}))})).then((function(e){return r.federatedServers[s]={expires:new Date(e.expires),token:e.token},delete r._pendingTokenRequests[s],e.token}))}))),this._pendingTokenRequests[s])},e.prototype.getFreshToken=function(e){var t=this
return this.token&&!this.tokenExpires||this.token&&this.tokenExpires&&this.tokenExpires.getTime()>Date.now()?Promise.resolve(this.token):(this._pendingTokenRequests[this.portal]||(this._pendingTokenRequests[this.portal]=this.refreshSession(e).then((function(e){return t._pendingTokenRequests[t.portal]=null,e.token}))),this._pendingTokenRequests[this.portal])},e.prototype.refreshWithUsernameAndPassword=function(e){var t=this,r=o({params:{username:this.username,password:this.password,expiration:this.tokenDuration}},e)
return a(this.portal+"/generateToken",r).then((function(e){return t._token=e.token,t._tokenExpires=new Date(e.expires),t}))},e.prototype.refreshWithRefreshToken=function(e){var t=this
if(this.refreshToken&&this.refreshTokenExpires&&this.refreshTokenExpires.getTime()<Date.now())return this.refreshRefreshToken(e)
var r=o({params:{client_id:this.clientId,refresh_token:this.refreshToken,grant_type:"refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t}))},e.prototype.refreshRefreshToken=function(e){var t=this,r=o({params:{client_id:this.clientId,refresh_token:this.refreshToken,redirect_uri:this.redirectUri,grant_type:"exchange_refresh_token"}},e)
return i(this.portal+"/oauth2/token",r).then((function(e){return t._token=e.token,t._tokenExpires=e.expires,t._refreshToken=e.refreshToken,t._refreshTokenExpires=new Date(Date.now()+60*(t.refreshTokenTTL-1)*1e3),t}))},e.prototype.fetchAuthorizedDomains=function(){var e=this
return this.server||!this.portal?Promise.resolve(this):this.getPortal().then((function(t){return t.authorizedCrossOriginDomains&&t.authorizedCrossOriginDomains.length&&(e.trustedDomains=t.authorizedCrossOriginDomains.filter((function(e){return!e.startsWith("http://")})).map((function(e){return e.startsWith("https://")?e:"https://"+e}))),e}))},e}()}}])
